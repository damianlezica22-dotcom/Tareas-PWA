<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tareas con Google Calendar</title>
  <link rel="manifest" href="manifest.json" />
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
  <script src="https://apis.google.com/js/api.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js');
    }
  </script>
  <style>
    body {
      font-family: sans-serif;
      background: #121212;
      color: #fff;
      padding: 20px;
    }
    input, button {
      padding: 10px;
      margin: 5px 0;
      border: none;
      border-radius: 6px;
      font-size: 16px;
    }
    input {
      background: #2c2c2c;
      color: white;
    }
    button {
      background: #00bcd4;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }
    #calendar {
      margin-top: 20px;
      background: #fff;
      color: #000;
      border-radius: 8px;
      padding: 10px;
    }
  </style>
</head>
<body>
  <h1>ðŸ“… Tareas con Google Calendar</h1>
  <button onclick="initGoogle()">Iniciar sesiÃ³n con Google</button>
  <br><br>
  <input type="text" id="taskText" placeholder="Tarea..." />
  <input type="datetime-local" id="taskTime" />
  <button onclick="crearEvento()">Agregar al calendario</button>

  <div id="calendar"></div>

  <script>
    let calendar;

    function initGoogle() {
      gapi.load('client:auth2', () => {
        gapi.client.init({
          apiKey: 'AIzaSyBha30lUfAE3_vJWecPzqYiuAgz16qTUuk',
          clientId: '523990187155-pli4rp2tji7n0m4tjjprlnoqpdk775c0.apps.googleusercontent.com',
          discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"],
          scope: 'https://www.googleapis.com/auth/calendar.events'
        }).then(() => {
gapi.auth2.getAuthInstance().signIn().then(() => {
  alert("âœ… Autenticado con Google");
  renderCalendar();
}).catch(error => {
  console.error("Error al iniciar sesiÃ³n:", error);
  alert("âŒ No se pudo iniciar sesiÃ³n. RevisÃ¡ la consola para mÃ¡s detalles.");

          });
        });
      });
    }

    function crearEvento() {
      const texto = document.getElementById('taskText').value;
      const fecha = document.getElementById('taskTime').value;
      if (!texto || !fecha) return;

      const inicio = new Date(fecha);
      const fin = new Date(inicio.getTime() + 30 * 60 * 1000); // 30 min

      const evento = {
        summary: texto,
        start: { dateTime: inicio.toISOString() },
        end: { dateTime: fin.toISOString() }
      };

      gapi.client.calendar.events.insert({
        calendarId: 'primary',
        resource: evento
      }).then(res => {
        alert("ðŸ“Œ Evento creado en tu Google Calendar");
        calendar.refetchEvents();
      });
    }

    function renderCalendar() {
      const calendarEl = document.getElementById('calendar');
      calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        headerToolbar: {
          left: 'prev,next today',
          center: 'title',
          right: 'dayGridMonth,timeGridWeek,timeGridDay'
        },
        events: function (fetchInfo, successCallback, failureCallback) {
          gapi.client.calendar.events.list({
            calendarId: 'primary',
            timeMin: fetchInfo.startStr,
            timeMax: fetchInfo.endStr,
            showDeleted: false,
            singleEvents: true,
            orderBy: 'startTime'
          }).then(response => {
            const events = response.result.items.map(ev => ({
              title: ev.summary,
              start: ev.start.dateTime || ev.start.date,
              end: ev.end.dateTime || ev.end.date
            }));
            successCallback(events);
          }, failureCallback);
        }
      });
      calendar.render();
    }
  </script>
</body>
</html>